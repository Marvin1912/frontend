<div class="add-word-container h-100 container-fluid p-2 d-flex flex-column align-items-center">

  <header class="flex-shrink-0 mb-3">
    <div class="d-flex justify-content-between align-items-center">
      <h1 class="mb-0">Add Word</h1>
      <button
        mat-icon-button
        color="primary"
        aria-label="Go to home"
        routerLink="/"
        type="button"
      >
        <mat-icon>home</mat-icon>
      </button>
    </div>
  </header>

  @if (!isFromRouteCall) {
    <section class="word-input-section flex-shrink-0 mb-3">
      <div class="search-input-container">
        <mat-form-field appearance="outline" class="flex-grow-1">
          <mat-label>Enter English word</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="word"
            (keyup.enter)="getWord(word)"
            placeholder="Type a word and press Enter"
          >
        </mat-form-field>
        @if (word) {
          <button
            mat-icon-button
            color="primary"
            aria-label="Search word"
            (click)="getWord(word)"
            type="button"
            class="search-button-aligned"
          >
            <mat-icon>search</mat-icon>
          </button>
        }
      </div>
    </section>
  }

  <main class="row flex-grow-1 w-100 main-content" style="min-height: 0">

    <!-- Dictionary Results Section -->
    <section class="col h-100 d-flex flex-column gap-3 dictionary-section" style="min-height: 0">
      @if (wordToShow) {
        <header class="flex-shrink-0">
          <h1 class="word-title">{{ wordToShow }}</h1>
        </header>
      }

      <div class="flex-grow-1 overflow-auto dictionary-results border border-1 rounded-3" style="min-height: 0">
        <div class="d-flex flex-column gap-3 p-3">
          @for (wordEntry of wordEntries(); track wordEntry; let entryIndex = $index) {
            <div class="word-entry d-flex flex-column gap-3">
              @for (meaning of wordEntry.meanings; track meaning; let meaningIndex = $index) {
                <div class="meaning-card d-flex flex-column p-3 gap-3 border border-2 rounded-3">
                  <div class="part-of-speech-badge">
                    <span class="badge">{{ meaning.partOfSpeech }}</span>
                  </div>

                  @for (definition of meaning.definitions; track definition; let definitionIndex = $index) {
                    <div
                      class="definition-item d-flex flex-column border border-1 rounded-3 gap-2 p-3"
                      [ngClass]="{chosen: isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                    >
                      <p class="definition-text mb-0">{{ definition.definition }}</p>

                      <div class="definition-actions d-flex gap-3 flex-wrap">
                        <button
                          class="action-button"
                          [ngClass]="{selected: isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                          (click)="setChosenText(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex), definition.definition)"
                          type="button"
                        >
                          @if (isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))) {
                            <mat-icon class="action-icon">check_circle</mat-icon>
                            <span>Using as description</span>
                          } @else {
                            <mat-icon class="action-icon">description</mat-icon>
                            <span>Use as description</span>
                          }
                        </button>

                        <button
                          class="action-button"
                          [ngClass]="{selected: isChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                          (click)="setChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex), definition.definition)"
                          type="button"
                        >
                          @if (isChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))) {
                            <mat-icon class="action-icon">check_circle</mat-icon>
                            <span>Added to context</span>
                          } @else {
                            <mat-icon class="action-icon">add_circle</mat-icon>
                            <span>Add to context</span>
                          }
                        </button>
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          }
        </div>
      </div>

      <!-- Translation Section -->
      <footer class="flex-shrink-0 translation-section border border-1 rounded-3 p-3">
        <header class="translation-header mb-3">
          <h5 class="mb-0">Translation</h5>
        </header>

        <form
          [formGroup]="wordFormTranslation"
          (ngSubmit)="onSubmitTranslation()"
          class="translation-form d-flex gap-3"
        >
          <mat-form-field appearance="outline" class="flex-grow-1">
            <mat-label>Word</mat-label>
            <input matInput formControlName="word">
          </mat-form-field>

          <mat-form-field appearance="outline" class="flex-grow-1">
            <mat-label>Context</mat-label>
            <input matInput formControlName="context">
          </mat-form-field>

          <button
            mat-flat-button
            color="primary"
            [disabled]="!wordFormTranslation.valid"
            type="submit"
          >
            Translate
          </button>
        </form>

        @if (translation()) {
          <div class="translation-result mt-3">{{ translation() }}</div>
        }
      </footer>
    </section>

    <!-- Save Word Section -->
    <section class="d-flex flex-column col h-100 w-100 save-section" style="min-height: 0">
      @if (wordToShow) {
        <header class="flex-shrink-0 pb-3">
          <h1>Save Word</h1>
        </header>

        <div class="flex-grow-1 d-flex flex-column border border-1 rounded-3 overflow-auto save-form-container"
             style="min-height: 0">
          <div class="flex-shrink-0 d-flex gap-3 p-3 part-of-speech-selector">
            <mat-button-toggle-group [(ngModel)]="partOfSpeech" name="partOfSpeech">
              @for (pos of partsOfSpeech; track pos) {
                <mat-button-toggle
                  (click)="addArticleToWord(pos)"
                  [value]="pos"
                >
                  {{ pos }}
                </mat-button-toggle>
              }
            </mat-button-toggle-group>
          </div>

          <form
            class="flex-grow-1 d-flex flex-column justify-content-between gap-3 p-3 save-form"
            [formGroup]="wordForm"
            (ngSubmit)="onSubmit()"
          >
            <mat-form-field appearance="outline">
              <mat-label>Deck</mat-label>
              <input matInput formControlName="deck">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Front</mat-label>
              <input matInput formControlName="front">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Back</mat-label>
              <input matInput formControlName="back">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description" rows="3"></textarea>
            </mat-form-field>

            <button
              mat-flat-button
              color="primary"
              [disabled]="!wordForm.valid"
              class="submit-button"
              type="submit"
            >
              {{ update() ? 'Update' : 'Save' }}
            </button>
          </form>
        </div>
      }
    </section>

  </main>

</div>
