<div class="add-word-container">

  @if (!isFromRouteCall) {
    <section class="search-section">
      <div class="search-container">
        <div class="search-input-wrapper">
          <mat-form-field appearance="outline" >
          <mat-label>Enter English word</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="word"
            (keyup.enter)="getWord(word)"
            placeholder="Type a word and press Enter"
          >
        </mat-form-field>
        @if (word) {
          <button
            mat-icon-button
            color="primary"
            aria-label="Search word"
            (click)="getWord(word)"
            type="button"

          >
            <mat-icon>search</mat-icon>
          </button>
        }
        </div>
      </div>
    </section>
  }

  <main class="main-content">

    <!-- Dictionary Results Section -->
    <section class="dictionary-section">
      @if (wordToShow) {
        <header class="dictionary-header">
          <h1 class="word-title">{{ wordToShow }}</h1>
        </header>
      }

      <div class="word-entries-container">
        <div class="word-entry">
          @for (wordEntry of wordEntries(); track wordEntry; let entryIndex = $index) {
            <div class="word-entry">
              @for (meaning of wordEntry.meanings; track meaning; let meaningIndex = $index) {
                <div class="meaning-block">
                  <div class="part-of-speech">
                    <span >{{ meaning.partOfSpeech }}</span>
                  </div>

                  @for (definition of meaning.definitions; track definition; let definitionIndex = $index) {
                    <div
                      class="definition-item"
                      [ngClass]="{chosen: isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                    >
                      <p class="definition-text">{{ definition.definition }}</p>

                      <div class="definition-actions">
                        <button
                          
                          [ngClass]="{selected: isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                          (click)="setChosenText(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex), definition.definition)"
                          type="button"
                        >
                          @if (isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))) {
                            <mat-icon >check_circle</mat-icon>
                            <span>Using as description</span>
                          } @else {
                            <mat-icon >description</mat-icon>
                            <span>Use as description</span>
                          }
                        </button>

                        <button
                          
                          [ngClass]="{selected: isChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                          (click)="setChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex), definition.definition)"
                          type="button"
                        >
                          @if (isChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))) {
                            <mat-icon >check_circle</mat-icon>
                            <span>Added to context</span>
                          } @else {
                            <mat-icon >add_circle</mat-icon>
                            <span>Add to context</span>
                          }
                        </button>
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          }
        </div>
      </div>

      <!-- Translation Section -->
      <footer class="translation-footer">
        <header>
          <h5 >Translation</h5>
        </header>

        <form
          class="translation-form"
          [formGroup]="wordFormTranslation"
          (ngSubmit)="onSubmitTranslation()"
        >
          <mat-form-field appearance="outline" >
            <mat-label>Word</mat-label>
            <input matInput formControlName="word">
          </mat-form-field>

          <mat-form-field appearance="outline" >
            <mat-label>Context</mat-label>
            <input matInput formControlName="context">
          </mat-form-field>

          <button
            mat-flat-button
            color="primary"
            [disabled]="!wordFormTranslation.valid"
            type="submit"
          >
            Translate
          </button>
        </form>

        @if (translation()) {
          <div class="translation-result">{{ translation() }}</div>
        }
      </footer>
    </section>

    <!-- Save Word Section -->
    <section class="save-section">
      @if (wordToShow) {
        <header class="save-header">
          <h1>Save Word</h1>
        </header>

        <div class="save-content">
          <div class="part-of-speech-selector">
            <mat-button-toggle-group [(ngModel)]="partOfSpeech" name="partOfSpeech">
              @for (pos of partsOfSpeech; track pos) {
                <mat-button-toggle
                  (click)="addArticleToWord(pos)"
                  [value]="pos"
                >
                  {{ pos }}
                </mat-button-toggle>
              }
            </mat-button-toggle-group>
          </div>

          <form
            class="save-form"
            [formGroup]="wordForm"
            (ngSubmit)="onSubmit()"
          >
            <mat-form-field appearance="outline">
              <mat-label>Deck</mat-label>
              <input matInput formControlName="deck">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Front</mat-label>
              <input matInput formControlName="front">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Back</mat-label>
              <input matInput formControlName="back">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description" rows="3"></textarea>
            </mat-form-field>

            <button
              mat-flat-button
              color="primary"
              [disabled]="!wordForm.valid"
              
              type="submit"
            >
              {{ update() ? 'Update' : 'Save' }}
            </button>
          </form>
        </div>
      }
    </section>

  </main>

</div>
