<div class="add-word-container">

  @if (!isFromRouteCall) {
    <div class="search-section">
      <div class="search-input-wrapper">
        <mat-form-field appearance="outline">
          <mat-label>Enter English word</mat-label>
          <input
              matInput
              type="text"
              [(ngModel)]="word"
              (keyup.enter)="getWord(word)"
              placeholder="Type a word and press Enter"
          >
        </mat-form-field>
        @if (word) {
          <button
              mat-icon-button
              color="primary"
              aria-label="Search word"
              (click)="getWord(word)"
              type="button"
          >
            <mat-icon>search</mat-icon>
          </button>
        }
      </div>
    </div>
  }

  <div class="add-word-main">

    <!-- Dictionary Results Section -->
    <div class="dictionary-results-section">
      @if (wordToShow) {
        <div class="word-header">
          <h1 class="word-title">{{ wordToShow }}</h1>
        </div>
      }

      <div class="word-entries-container">
        <div class="word-entries-list">
          @for (wordEntry of wordEntries(); track wordEntry; let entryIndex = $index) {
            <div class="word-entry">
              @for (meaning of wordEntry.meanings; track meaning; let meaningIndex = $index) {
                <div class="meaning-group">
                  <div class="part-of-speech-header">
                    <span class="part-of-speech">{{ meaning.partOfSpeech }}</span>
                  </div>

                  @for (definition of meaning.definitions; track definition; let definitionIndex = $index) {
                    <div class="definition-item"
                         [ngClass]="{chosen: isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                    >
                      <p class="definition-text">{{ definition.definition }}</p>

                      <div class="definition-actions">
                        <button
                            [ngClass]="{selected: isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                            (click)="setChosenText(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex), definition.definition)"
                            type="button"
                        >
                          @if (isChosen(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))) {
                            <mat-icon>check_circle</mat-icon>
                            <span>Using as description</span>
                          } @else {
                            <mat-icon>description</mat-icon>
                            <span>Use as description</span>
                          }
                        </button>

                        <button
                            [ngClass]="{selected: isChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))}"
                            (click)="setChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex), definition.definition)"
                            type="button"
                        >
                          @if (isChosenForContext(getDefinitionIndex(entryIndex, meaningIndex, definitionIndex))) {
                            <mat-icon>check_circle</mat-icon>
                            <span>Added to context</span>
                          } @else {
                            <mat-icon>add_circle</mat-icon>
                            <span>Add to context</span>
                          }
                        </button>
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          }
        </div>
      </div>

      <!-- Translation Section -->
      @if (wordToShow) {
        <div class="translation-section">
          <div class="translation-header">
            <h5 class="translation-title">Translation</h5>
          </div>

          <form
              [formGroup]="wordFormTranslation"
              (ngSubmit)="onSubmitTranslation()"
          >
            <mat-form-field appearance="outline">
              <mat-label>Word</mat-label>
              <input matInput formControlName="word">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Context</mat-label>
              <input matInput formControlName="context">
            </mat-form-field>

            <button
                mat-flat-button
                color="primary"
                [disabled]="!wordFormTranslation.valid"
                type="submit"
            >
              Translate
            </button>
          </form>

          @if (translation()) {
            <div class="translation-result">{{ translation() }}</div>
          }
        </div>
      }
    </div>

    <!-- Save Word Section -->
    <div class="save-word-section">
      @if (wordToShow) {
        <div class="save-word-header">
          <h1>Save Word</h1>
        </div>

        <div class="save-word-content">
          <div class="part-of-speech-toggle-group">
            <mat-button-toggle-group [(ngModel)]="partOfSpeech" name="partOfSpeech">
              @for (pos of partsOfSpeech; track pos) {
                <mat-button-toggle
                    (click)="addArticleToWord(pos)"
                    [value]="pos"
                >
                  {{ pos }}
                </mat-button-toggle>
              }
            </mat-button-toggle-group>
          </div>

          <form
              [formGroup]="wordForm"
              (ngSubmit)="onSubmit()"
          >
            <mat-form-field appearance="outline">
              <mat-label>Deck</mat-label>
              <input matInput formControlName="deck">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Front</mat-label>
              <input matInput formControlName="front">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Back</mat-label>
              <input matInput formControlName="back">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description" rows="3"></textarea>
            </mat-form-field>

            <button
                mat-flat-button
                color="primary"
                [disabled]="!wordForm.valid"
                type="submit"
            >
              {{ update() ? 'Update' : 'Save' }}
            </button>
          </form>
        </div>
      }
    </div>

  </div>

</div>
